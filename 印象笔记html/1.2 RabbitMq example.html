<html>
<head>
  <title>1.2 RabbitMq example</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600480 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="450"/>
<h1>1.2 RabbitMq example</h1>

<div>
<span><div><div>springboot整合rabbitmq——Spring AMQP（安装rabbitmq后只新建了一个管理员权限用户和建立一个虚拟主机  /pawo_power  ），以下为demo演示，使用的是交换机中默认的direct模式，一对一，生产者指定key就可以发送，同时接收者通过key来接收。</div><hr/><div>(1) yaml配置</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spring:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  rabbitmq:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    addresses: 127.0.0.1</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    virtual-host: /pawo_power</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    username: gmzhao</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    password: 123456</span></div></div><div>(2)config全局配置（注册队列信息）——————配置完成，启动服务将自动在rabbitmq中永久创建一个队列</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@Configuration</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class MqConfig {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @Bean</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public Queue Queue() {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return new Queue(&quot;queue&quot;);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div>(3)生产者</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@RestController</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@RequestMapping(&quot;rabbit&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class MqProducterTest {</span></div><div><br/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @Autowired</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    private RabbitTemplate rabbitTemplate;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @GetMapping(&quot;amqp/test&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public void testAMQP(){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        for(int i = 0 ;i &lt; 10; i++) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            rabbitTemplate.convertAndSend(&quot;queue&quot;, &quot;queue  salijaljlsjlj&quot;);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div>(4)消费者监听</div><div>类上写的注解会监听到queue这个队列发来的消息，然后交给被@RabbitHandler标注的方法处理。当有多个队列时，@RabbitListener可以直接加在方法上，省去写@RabbitHandler</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@Component</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@RabbitListener(queues = &quot;queue&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class MqListener {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @RabbitHandler</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public void process(String hello) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        System.out.println(&quot;Receiver  : &quot; + hello);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><a href="https://www.cnblogs.com/jhcelue/p/7105290.html">https://www.cnblogs.com/jhcelue/p/7105290.html</a></div><div><br/></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import org.springframework.amqp.rabbit.core.RabbitTemplate;</span></div><div><br/></div><div><br/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@Service</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@Slf4j</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class FutuPushServiceImpl implements IFutuPushService {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"> </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    private static final <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">String CTP_EXCHANGE = &quot;ctp-exchange&quot;;</span></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    private static final <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">String PUSH_ROUTING_KEY = &quot;push-event&quot;;</span></span></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    private static final String MQ_NOTIFY_PUSH   = &quot;i2:ctp:push&quot;;</span></div><div><br/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    private final RabbitTemplate rabbitTemplate;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public FutuPushServiceImpl(RabbitTemplate rabbitTemplate) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        this.rabbitTemplate = rabbitTemplate;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @Override</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public void send(GeneratedMessageV3 messagBody, MsgDefine.Action action, String cbUrl) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        final Msg.Packet pushMessage = Msg.Packet.newBuilder()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                .setHeader(header)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                .setBody(messagBody.toByteString())</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                .setPush(pushContext)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                .setAction(action)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                .build();</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        rabbitTemplate.convertAndSend(FutuConst.CTP_EXCHANGE, FutuConst.PUSH_ROUTING_KEY, pushMessage);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        log.info(&quot;推送队列名称 {} 消息体--- \n{}&quot;, FutuConst.MQ_NOTIFY_PUSH, pushMessage);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @Override</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public void send(GeneratedMessageV3 messagBody, MsgDefine.Action action) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        send(messagBody,action, StringPool.EMPTY);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>1.maven依赖：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.amqp&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-rabbit&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;version&gt;1.7.11.RELEASE&lt;/version&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;/dependency&gt;</span></div></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 