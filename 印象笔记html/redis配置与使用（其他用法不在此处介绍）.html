<html>
<head>
  <title>redis配置与使用（其他用法不在此处介绍）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600480 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="541"/>
<h1>redis配置与使用（其他用法不在此处介绍）</h1>

<div>
<span><div><div><div>1.redis是一种非关系型数据库，用键值对来存储数据库。</div><div>安装完成后cmd打开两个窗口进入redis的安装目录中</div><ul><li><div>第一个窗口，启用一个redis服务</div></li></ul><div><span style="border: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">       redis-server.exe redis.windows.conf</span> <span style="border: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">用于指定redis.windows.conf配置文件来启动redis服务</span></div><div><span style="font-size: 13px; border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; -webkit-text-stroke-width: 0px; white-space: normal; widows: 2; word-spacing: 0px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">                说明：</span><span style="font-size: 13px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">(2)</span><span style="font-size: 13px; border: 0px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; -webkit-text-stroke-width: 0px; white-space: normal; widows: 2; word-spacing: 0px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"> linux版本redis的配置文件是redis.conf</span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">                 </span><span style="border: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">(1)</span><span style="color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;"> 启动redis时如果只输入redis-server.exe，不指定配置文件，则默认调用  redis.windows-service.conf  这个配置文件，因此在redis.windows.conf中更改的配置信息并不会生效</span></div><ul><li><div><span style="border: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-variant-caps: normal; font-variant-ligatures: normal;">第二个窗口客户端(Client)执行</span><span style="border: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">  <span style="border: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">redis-cli.exe -h 127.0.0.1 -p 6379</span></span></div></li></ul><div><span style="font-family: &quot;Helvetica Neue&quot;;">           说明：-h和-p代表该客户端与哪个主机和端口的redis进行连接</span></div><div><br/></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; color: rgb(0, 0, 0); font-variant-caps: normal; font-variant-ligatures: normal;">2.Redis可以存储键与5种不同数据结构类型之间的映射，这5种数据结构类型分别为String（字符串）、List（列表）、Set（集合）、Hash（散列）和 Zset（有序集合）。</span></span></div></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; color: rgb(0, 0, 0); font-variant-caps: normal; font-variant-ligatures: normal;">(1)获取到redisTemplate，可以对以上数据进行操作，分别是</span></span></div><ul><li><div>//操作字符串   redisTemplate.opsForValue();</div></li><li><div>//操作hash   redisTemplate.opsForHash();</div></li><li><div>//操作list  redisTemplate.opsForList();</div></li><li><div>//操作set  redisTemplate.opsForSet();</div></li><li><div>//操作有序set   redisTemplate.opsForZSet();</div></li></ul><div>    以上各自key值，都可以通过redisTeamplate.delete();方法来删除。<span style="font-style: italic;">forHash适合存储对象，redis的设置使它像</span><span style="font-style: italic;">一个 &quot; map&quot; 结构</span><span style="font-style: italic;">。</span></div><div><br/></div><div><span style="font-size: 10pt;">(2)同一个key值，多次赋值会覆盖掉。当有赋值值，就不允许再用其他类型覆盖。例如如下两种都执行会报错。</span></div><div><span style="font-size: 10pt;"><span style="font-size: 10pt; font-style: italic;">key值中间如果有冒号，RedisDesktopManager工具会生成文件夹目录</span></span></div><div>redisTemplate.opsForHash().put(&quot;name&quot;,&quot;gmzhao&quot;,&quot;age = 18 , major = mining&quot;);</div><div>redisTemplate.opsForValue().set(&quot;name&quot;,new Object())</div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 10pt;">3.springboot与Redis集成</span></div><div><br/></div><div><span style="font-size: 10pt;">3.1全局配置:</span></div><hr/><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">&lt;!-- 提供redis序列化支持 --&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-data-redis&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt;">&lt;/dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt;">&lt;!-- springboot 支持 redis </span><span style="font-family: Monaco; font-size: 9pt;"> --&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;dependency&gt;</span></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;/dependency&gt;</span></div></div><div><span style="font-size: 10pt;">(1)配置</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@Configuration</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class RedisConfig {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    private static Logger logger = LoggerFactory.getLogger(RedisConfig.class);</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @Bean(name = &quot;springSessionDefaultRedisSerializer&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public GenericJackson2JsonRedisSerializer getGenericJackson2JsonRedisSerializer() {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return new GenericJackson2JsonRedisSerializer();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @Bean</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public RedisTemplate&lt;String, Object&gt; getRedisTemplate(</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            JedisConnectionFactory connectionFactory) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        RedisTemplate&lt;String, Object&gt; redisTemplate = new RedisTemplate&lt;String, Object&gt;();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        redisTemplate.setConnectionFactory(connectionFactory);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        redisTemplate.setDefaultSerializer(new GenericJackson2JsonRedisSerializer());</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        //设置键值和value值为json格式序列化</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        StringRedisSerializer stringRedisSerializer = new StringRedisSerializer();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        redisTemplate.setKeySerializer(stringRedisSerializer);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        redisTemplate.setHashKeySerializer(stringRedisSerializer);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return redisTemplate;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><span style="font-style: italic; font-weight: bold;">参考博客</span>:json序列化demo <a href="https://blog.csdn.net/u010180738/article/details/79383246">https://blog.csdn.net/u010180738/article/details/79383246</a></div><div>序列化比较: <a href="https://blog.csdn.net/xueqinmax/article/details/81366087">https://blog.csdn.net/xueqinmax/article/details/81366087</a></div><div><br/></div><div><span style="font-size: 10pt;">(2)使用</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">//可以直接通过构造器注入</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@Autowired</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public RedisController(RedisTemplate&lt;String, Object&gt; redisTemplate) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        this.valueOperations = redisTemplate.opsForValue();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        this.hashOperations = redisTemplate.opsForHash();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><br/></span></div><div><br/></div><div><br/></div><div><br/></div><div>3.2单一引用：</div><hr/><div>(1) pom添加依赖</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;!-- springboot 支持 redis </span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"> --&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;dependency&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;/dependency&gt;</span></div></div><div>(2)yaml文件添加配置:<span style="font-weight: bold;">//springboot中使用的默认配置，连接池最大连接数为8</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">spring:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  redis:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    host: 127.0.0.1</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    ##密码无值默认为空</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    password:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    port: 6379</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    pool:</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      #连接池中最大空闲连接</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      max-idle: 100</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      #连接池中最小空闲连接</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      min-idle: 1</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      #连接池最大连接数</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      max-active: 1000</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># 连接池最大阻塞等待时间（使用负值表示没有限制）</span></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      max-wait: -1s</span></div></div><div>(3)自动注入即可，json序列化部分则要手动设置<span style="font-size: 9pt; color: rgb(0, 0, 0); font-family: Monaco;">redisTemplate对象</span>属性，详见全局配置部分内容：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt;"><font style="color: rgb(0, 0, 0);">@Resource</font></span></div><div><font style="color: rgb(0, 0, 0);"><span style="font-family: Monaco; font-size: 9pt;">RedisTemplate&lt;String</span><span style="font-family: Monaco; font-size: 9pt;">,</span><span style="font-family: Monaco; font-size: 9pt;">Object&gt;</span> <span style="font-family: Monaco; font-size: 9pt;">redisTemplate</span><span style="font-family: Monaco; font-size: 9pt;">;</span></font></div></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">（4）关于用@Resource来注入RedisTemplate的问题</span></div></div><div>springboot官方文档中，有如下说明</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">If you add a @Bean of your own of any of the auto-configured types it will replace the default (except in the case of RedisTemplate the exclusion is based on the bean name ‘redisTemplate’ not its type</span></div></div><div>大致意思是在注入redisTemplate时，默认是按照名称来注入而不是按照类型。我们知道@Autowired是按照类型来注入，而@Resource是按照名称来注入的，所以此处当然是用@Resource来进行啦。</div><div><br/></div><div><br/></div><div>4.RedisTemplate与StringrRedisTemplate</div><div>StringRedisTemplate继承于RedisTemplate，相对于默认RedisTemplate，指定了序列化的方式按照StringRedisSerializer来进行序列化，最终存入redis的就不是16进制的数据了。</div><div>需要注意的是两者的数据是不共通的；也就是说StringRedisTemplate只能管理StringRedisTemplate里面的数据，RedisTemplate只能管理RedisTemplate中的数据。</div><div>StringRedisTemplate相对于RedisTemplate，可以直接用@Autowired来进行注入。</div><div><br/></div><div><br/></div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-size: 16pt; font-weight: bold;-evernote-highlight:true;">5.关于redis采坑</span></span></div><div><span style="background-color: rgb(255, 250, 165); font-weight: bold;-evernote-highlight:true;">1.场景： 在配置类的 package com.gm.redis ，一开始没发现，以为是pom版本问题，折腾了半天，发现是package 路径由于设置Resource时设置错导致package 路径自动改动了，但是启动时候又没有任何报错提示。各种查资料最后居然是这么简单的问题。以后要从基础的改动开始找。</span></div><div><span style="background-color: rgb(255, 250, 165); font-weight: bold;-evernote-highlight:true;">2.场景：多模块结构中， <span style="background-color: rgb(255, 250, 165); font-weight: bold;-evernote-highlight:true;">&lt;packaging&gt;设置默认是jar类型，这时候启动模块，对于其他模块的内容加载不到，会报错加载不到RedisTemplate。设置一下&lt;packaging&gt;pom&lt;/packaging&gt;就可以了！他妈折腾了我一个星期快！啊啊啊！这说明自己对多模块之间如何依赖还不熟练！！！对启动类如何加载其他模块还不明确！！！以后要知道了！</span></span></div></span>
</div></body></html> 