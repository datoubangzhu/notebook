<html>
<head>
  <title>Spring事务管理</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600480 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="703"/>
<h1>Spring事务管理</h1>

<div>
<span><div>6.spring事物传播机制、使用</div><div><span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">PROPAGATION_REQUIRED</span>   如果当前没有事务，就新建一个事务，如果已经存在一个事务中，加入到这个事务中。（spring默认）</div><div><span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">PROPAGATION_SUPPORTS   </span><span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">支持当前事务，如果当前没有事务，就以非事务方式执行。</span></div><div><span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">PROPAGATION_MANDATORY    </span> <span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">使用当前的事务，如果当前没有事务，就抛出异常</span></div><div><span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">PROPAGATION_REQUIRES_NEW    </span> <span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">新建事务，如果当前存在事务，把当前事务挂起。</span></div><div><span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">PROPAGATION_NOT_SUPPORTED    </span> <span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">以非事务方式执行操作，如果当前存在事务，就把当前事务挂起</span></div><div><span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">PROPAGATION_NEVER    </span> <span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">以非事务方式执行，如果当前存在事务，则抛出异常</span></div><div><span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">PROPAGATION_NESTED   </span> <span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">如果当前存在事务，则在嵌套事务内执行。如果当前没有事务，则按照PROPAGATION_REQUIRED操作</span></div><div><a href="https://www.cnblogs.com/softidea/p/5962612.html" style="font-family: Verdana;">https://www.cnblogs.com/softidea/p/5962612.html</a></div><div><br/></div><div>案例：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="color: rgb(51, 51, 51); font-size: 10pt; font-family: 微软雅黑;">//isolation为事务隔离级别，timeout为超时时间，超时时是否回滚需要讨论</span></div><div><span style="color: rgb(51, 51, 51); font-size: 10pt; font-family: 微软雅黑;">//超时时是否回滚的讨论  </span><a href="https://blog.csdn.net/heweimingming/article/details/51841133" style="color: rgb(51, 51, 51); font-size: 10pt; font-family: 微软雅黑;">https://blog.csdn.net/heweimingming/article/details/51841133</a></div><div><span style="color: rgb(51, 51, 51); font-size: 10pt; font-family: 微软雅黑;">@Transactional(propagation=Propagation.REQUIRED, isolation = Isolation.READ_COMMITTED,</span><span style="color: rgb(51, 51, 51); font-size: 10pt; font-family: 微软雅黑;"> timeout = 30</span><span style="color: rgb(51, 51, 51); font-size: 10pt; font-family: 微软雅黑;">)</span></div><div><span style="color: rgb(51, 51, 51); font-size: 10pt; font-family: 微软雅黑;">public void test(){</span></div><div><span style="color: rgb(51, 51, 51); font-size: 10pt; font-family: 微软雅黑;">}</span></div></div><div><br/></div><div><a href="https://blog.csdn.net/shi750989074/article/details/78855770" style="font-family: Verdana;">https://blog.csdn.net/shi750989074/article/details/78855770</a></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">7.数据库隔离级别和spring事务隔离区别和联系：</span></div><div><span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">    当spring中开启了事物，就用spring的，如果没有，就用数据库默认的。</span></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">8.<span style="background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana; font-size: 13px; font-variant-caps: normal; font-variant-ligatures: normal;">spring 事物 关于在同一个类中一个方法调用另一个方法，事物的传播行为会失效的问题：</span></span></div><div><span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"><span style="background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana; font-size: 13px; font-variant-caps: normal; font-variant-ligatures: normal;"><span>这种情况发生在使用@Transaction声明事务的场合，看似与spring默认的事务传播行为PROPAGATION_REQUIRED违背，实则不然，这个问题的原因是spring动态代理造成的。</span></span></span></div><div><span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"><span style="background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana; font-size: 13px; font-variant-caps: normal; font-variant-ligatures: normal;"><br/></span></span></div><div><span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242);"><span style="background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana; font-size: 13px; font-variant-caps: normal; font-variant-ligatures: normal;">动态代理问题：</span></span></div><div><span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(254, 254, 242);"><span style="background-color: rgb(254, 254, 242); color: rgb(0, 0, 0); font-family: Verdana; font-size: 13px; font-variant-caps: normal; font-variant-ligatures: normal;">    <a href="https://blog.csdn.net/u011186019/article/details/80210593" style="background-color: rgb(254, 254, 242); font-family: Verdana; font-size: 13px; font-variant-caps: normal; font-variant-ligatures: normal;">https://blog.csdn.net/u011186019/article/details/80210593</a></span></span></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 