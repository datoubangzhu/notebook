<html>
<head>
  <title>1.3 RabbitMq exchange四种模式（example基础上）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600480 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="781"/>
<h1>1.3 RabbitMq exchange四种模式（example基础上）</h1>

<div>
<span><div><div><div><div>1. <span style="font-weight: bold;">Fanout模式</span></div><hr/><div>fanout是路由广播的形式,将会把消息发给绑定它的全部队列,此时如果设置路由器键值routing_key也会失效.</div><ul><li><div>注意配置文件中仍然需要进行队列绑定</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        //队列配置已省略                                                     </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        @Bean</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        Binding bindingExchangeB(@Qualifier(&quot;Bmessage&quot;) Queue BMessage, <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@Qualifier(&quot;fanout&quot;)</span>FanoutExchange fanoutExchange) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            return BindingBuilder.bind(BMessage).to(fanoutExchange);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        @Bean</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        Binding bindingExchangeC(@Qualifier(&quot;Cmessage&quot;) Queue CMessage, <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@Qualifier(&quot;<span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">fanout</span>&quot;)</span>FanoutExchange fanoutExchange) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            return BindingBuilder.bind(CMessage).to(fanoutExchange);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div></div><ul><li><div>消息发送</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">rabbitTemplate.convertAndSend(&quot;fanout&quot;,&quot;&quot;,&quot;helloworld fanout exchange&quot;);//原本key参数将被忽略</span></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>2.<span style="font-weight: bold;">topic 转发模式</span>（需要配置交换机和队列，并且将两者根据路由器键值绑定在一起）</div><hr/><ul><li><div>全局配置</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@Configuration</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class MqConfig {</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @Bean</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public Queue testQueue() {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return new Queue(&quot;queue&quot;);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @Bean</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public TopicExchange testExchange() {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return new TopicExchange(&quot;gmzhaoexchange&quot;);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">//如果队列只配置了一个，那么@Qualifier（&quot;<span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">testQueue</span>&quot;）可以不用写，交换器同理，<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">当不止一个交换机时Bind也需要指定，否则当配置多个交换机时，只会注入一个，已踩坑</span>。</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @Bean</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    Binding bindingExchangeMessage(@Qualifier(&quot;<span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">testQueue</span>&quot;) Queue queueMessage, <span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">@Qualifier（&quot;<span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">testExchange</span></span><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">&quot;）</span>TopicExchange exchange) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        //此处指定匹配规则: queue = exchange + &quot;key&quot;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return BindingBuilder.bind(queueMessage).to(exchange).with(&quot;<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">key</span>&quot;);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div></div><ul><li><div>生产者</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">//调用rabbitTemplate方法public void convertAndSend(String exchange, String routingKey, Object object);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">rabbitTemplate.convertAndSend(&quot;gmzhaoexchange&quot;,&quot;key&quot;,&quot;helloworld queue = key+exchange&quot;);</span></div></div><ul><li><div>消费者</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@Component</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public class MqListener {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @RabbitListener(queues = &quot;queue&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public void process(String hello) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        System.out.println(&quot;Receiver  : &quot; + hello);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><span style="font-style: italic; font-weight: bold;">参考博客： </span><a href="https://www.cnblogs.com/hlhdidi/p/6535677.html" style="font-style: italic; font-weight: bold;">https://www.cnblogs.com/hlhdidi/p/6535677.html</a></div></div><div><br/></div><div><br/></div><div>3.<span style="font-weight: bold;">Direct模式</span></div><hr/><div>direct是RabbitMQ默认的交换机模式,也是最简单的模式。即生产者发送消息时候指定队列名称就可以.</div><div><br/></div><div><br/></div><div><br/></div><div>4.<span style="font-weight: bold;">Headers模式</span></div><hr/><div>它需要把要发送的信息填充要Message对象中，然后设置这个消息一个头部标志。交换器配置：指定key value键值对定义匹配规则，根据Message的一些头部信息来分发过滤Message，忽略routing key的属性，如果Header信息和message消息的头信息相匹配，那么这条消息就匹配上了。</div><ul><li><div>配置</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @Bean</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public Queue headerQueue() {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return new Queue(&quot;headerQueue&quot;);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @Bean</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public HeadersExchange headersExchange(){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return new HeadersExchange(&quot;headerExchange&quot;);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @Bean</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    Binding connectHeaderExchange(){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return BindingBuilder.bind(headerQueue()).to(headersExchange()).where(&quot;token&quot;).matches(&quot;50448837&quot;);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div></div><ul><li><div>生产者</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        String msg = &quot;Hello HeadersMsg&quot;;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        MessageProperties messageProperties = new MessageProperties();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        messageProperties.setHeader(&quot;token&quot;, &quot;50448837&quot;);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        Message message = new Message(msg.getBytes(), messageProperties);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        rabbitTemplate.convertAndSend(&quot;headerExchange&quot;, &quot;&quot;,message);</span></div><div><br/></div></div><ul><li><div>消费者</div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    @RabbitListener(queues = &quot;headerQueue&quot;)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public void headersProcess(byte[] hello) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        System.out.println(&quot;HeadersQueue Receiver  : &quot; + new String(hello));</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div></div><div><br/></div><div><span style="font-style: italic; font-weight: bold;">参考博客：</span><a href="https://www.cnblogs.com/fightfordream/p/9048905.html" style="font-style: italic; font-weight: bold;">https://www.cnblogs.com/fightfordream/p/9048905.html</a></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 