<html>
<head>
  <title>oracle 命令行 同步数据说明</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600480 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="449"/>
<h1>oracle 命令行 同步数据说明</h1>

<div>
<span><div><div>涉及到的命令exp imb 操作 命令说明如下： 命令说明链接：<a href="https://blog.csdn.net/lsyuan1989/article/details/50418665">https://blog.csdn.net/lsyuan1989/article/details/50418665</a></div><div><br/></div><div>1.导出操作</div><div>在需要导出的的设备上使用命令行 执行如下命令</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>exp C##dev/dev123456 file=d:\backup_2018_5_3.dmp owner=C##dev</div></div><div>参数说明如下：</div><div>-C##dev   导出的用户</div><div>-dev123456    导出用户的密码</div><div>-file=...    导出的文件路径</div><div>-owner     导出指定用户的对象 可以使用其他参数</div><div>备注：空表会无法导出，踩坑</div><div><br/></div><div>2.导入操作</div><div>(1)执行导入操作时，要先创建与导出的用户一致的表空间等数据，分配到需要导入的用户。用户空间分配结束后执行如下命令</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>imp DEVTEST/dev123456 file=/home/oracle/backup/datas/20180528/i2_backup_20180528.dmp full=y ignore=n;</div></div><div>- C##dev 导入的用户</div><div> - dev123456 导入用户的密码 </div><div>- file=... 导入的文件路径 </div><div>- full 导入整个文件 </div><div>- IGNORE 忽略创建错误    </div><div>备注：用户密码包含@特殊字符时需要进行额外处理，例如：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt;">imp I2TEST/i2@Test#2018 file=D:\software\devtest_backup_20180807.dmp full=y ignore=n;</span></div><div><br/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">imp  I2TEST/&quot;&quot;&quot;i2@Test#2018&quot;&quot;&quot;@orcl  file=D:\software\devtest_backup_20180807.dmp full=y ignore=n log=D:\log.log;</span></div></div><div><br/></div><div>(2)不同表空间导入时，可能会出错，可以通过临时修改表空间名来完成</div><div>例如:原表空间为DEV，现在表空间为TEST,可以先修改现在表空间名为DEV，再导入，然后再改为TEST</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">--修改表空间名</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">ALTER  TABLESPACE  DEVTEST  RENAME  TO  TEST</span></div></div><div>(3)查询用户下包含的表的个数</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 11pt; color: rgb(51, 51, 51);">select count(*) from dba_tables where owner = 'devdba';</span></div></div><div><br/></div><div><br/></div><div>3.表空间操作</div><div>(1).查询表空间信息---查询表空间名称和占用空间信息</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>SELECT t.tablespace_name, round(SUM(bytes / (1024 * 1024)), 0) ts_size FROM dba_tablespaces t, dba_data_files d WHERE t.tablespace_name = d.tablespace_name GROUP BY t.tablespace_name;</div></div><div><br/></div><div>(2).查询表空间信息---查询表空间名称和文件信息</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>SELECT tablespace_name, file_id, file_name, round(bytes / (1024 * 1024), 0) total_space FROM dba_data_files ORDER BY tablespace_name;//不含临时表空间</div><div>select * from dba_tablespaces;//所有表空间及其路径等信息</div></div><div><br/></div><div>(3).创建表空间信息</div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">oracle在创建登录用户时要指定表空间和临时表空间。然后再表空间中创建表等等。</span></div><div>a.创建表空间</div><div>表空间名称 I2TBS ，文件路径为 F:\APP\FITZYYF\VIRTUAL\ORADATA\ORCL\dev.dbf， 初始 大小为 50m，最大 1024M.</div><div>注：版本为11r2时 无需orclpdb</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>CREATE tablespace I2TBS logging datafile '/u01/app/oracle/oradata/orcl/orclpdb/I2TBS.dbf' size 50 m AUTOEXTEND ON NEXT 50 M MAXSIZE 1024 M EXTENT MANAGEMENT LOCAL;//日志地址可以先查找SYSTEM表空间的地址</div></div><div>b.创建临时表空间</div><div>表空间名称 I2TBS_TEMP，文件路径为 F:\APP\FITZYYF\VIRTUAL\ORADATA\ORCL\dev_temp.dbf， 初始大小为 50m ，最大 1024M</div><div>注：版本为11r2时 无需orclpdb</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>CREATE TEMPORARY TABLESPACE I2TBS_TEMP TEMPFILE '/u01/app/oracle/oradata/orcl/orclpdb/I2TBS_TEMP.dbf' SIZE 50 m AUTOEXTEND ON NEXT 50 m MAXSIZE 1024 m EXTENT MANAGEMENT LOCAL;<span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">//日志地址可以先查找SYSTEM表空间的地址</span></div></div><div>c.删除表空间</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>drop tablespace dev_tbs including contents and datafiles;//注意表空间名不要加引号</div></div><div><br/></div><div><br/></div><div>4.创建用户</div><div>(1).创建用户 dev并指定表空间</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>CREATE USER &quot;C##DEV&quot; IDENTIFIED BY &quot;dev123456&quot; DEFAULT TABLESPACE I2TBS TEMPORARY TABLESPACE I2TBS_TEMP;</div></div><div>(2)授权用户</div><div>授权 dev用户有连接数据库和操作表和操作视图数据等权限。</div><div>CONNECT 连接权限</div><div>RESOURCE 操作表、视图、数据权限</div><div>DBA 管理员权限</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>GRANT CONNECT, RESOURCE,DBA TO &quot;C##DEV&quot;;</div></div><div>(3)查询用户所在表空间（在用户登录后查询自己用户）</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">select username,default_tablespace from user_users;</span></div></div><div>(4)删除用户</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Drop user xxx cascade;</span></div></div><div>(5)查看当前正在用'I2TEST'登录的连接用户</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">select * from v$session where username='I2TEST'</span></div></div><div>(6)杀死连接用户</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">alter system kill session  'sid,serial#’ ;  </span></div></div><div><br/></div><div><br/></div><div>5.备注说明</div><div>新建序列</div><div>12r2 序列代码如下，在11r2 执行时 去掉 NOKEEP NOSCALE GLOBAL</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>CREATE SEQUENCE &quot;C##DEV&quot;.&quot;SEQ_EAV_PT_IID&quot; MINVALUE 1 MAXVALUE 999999999999 INCREMENT BY 1 START WITH 41 CACHE 20 ORDER CYCLE NOKEEP NOSCALE GLOBAL ;</div></div><div>powerdesigner 生成的脚本中会自带 PDTYPES 可以直接删除或者不生成</div><div><br/></div><div>删除不活动的进程</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>SELECT a.sid, b.spid, a.serial#, a.lockwait, a.username, a.osuser, a.logon_time, a.last_call_et / 3600 last_hour, a.status, 'orakill ' || sid || ' ' || spid host_command, 'alter system kill session ''' || a.sid || ',' || a.serial# || ''';' sql_command FROM v$session a, v$process b WHERE a.paddr = b.addr;</div></div><div><br/></div><div><br/></div><hr/><div><br/></div><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 